@using EPiServer.Framework.Web.Resources
@using EPiServer.Shell
@using EPiServer.Shell.Navigation
@{
    Layout = string.Empty;
    var inFormView = ViewBag.PreselectedFormGuid;
    var adminModuleCss = Paths.ToClientResource("EPiServer.Cms.UI.Admin", "ClientResources/dist/admin.bundle.css");
    var navigationCss = Paths.ToClientResource("Shell", "ClientResources/navigation.bundle.css");

    var styleCss = "/_content/AdvancedFormSubmissions/styles/dashboard.css";
    var scriptJs = "/_content/AdvancedFormSubmissions/scripts/dashboard.js";
}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
<head>
    <meta charset="utf-8" />
    <title>Form Submissions Dashboard</title>

    <!-- Admin CSS -->
    <link href="@adminModuleCss" rel="stylesheet" type="text/css" />

    @if (inFormView != null)
    {
        <link href="@navigationCss" rel="stylesheet" type="text/css" />
    }

    <!-- Shell + Theme -->
    @ClientResources.RenderResources("ShellCore")
    @ClientResources.RenderResources("ShellCoreLightTheme")

    <!-- Plugin Styles -->
    <link href="@styleCss" rel="stylesheet" type="text/css" />

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" rel="stylesheet" />

    <script>
        window.FormSubmissionsConfig = {
          preselectedFormGuid: "@ViewBag.PreselectedFormGuid",
        };
    </script>
</head>

<body class="epi-formSubmissions">
    @Html.AntiForgeryToken()
    @if (inFormView == null)
    {
        @Html.CreatePlatformNavigationMenu()
    }
    <div @Html.ApplyPlatformNavigation() style="height: calc(100vh - 40px);">
        <div class="content-area-container">
            <div class="axiom-layout-grid-container content-types-container">
                <div class="axiom-layout-grid">
                    <div class="axiom-layout-grid__cell axiom-layout-grid__cell--span-12-large">
                        <div class="axiom-grid-container content-types-list epi-padding">
                            @if (inFormView == null)
                            {
                                <div class="axiom-grid">
                                    <div class="axiom-grid__cell axiom-grid__cell--span-12-large">
                                        <div class="epi-main-header">
                                            <h1 class="epi-uif-typography mdc-typography--headline1">Form Submissions Dashboard</h1>
                                        </div>
                                        <p class="epi-uif-typography mdc-typography--body1">
                                            View and manage Optimizely Forms submissions in a simplified, user-friendly table with filtering, paging, and CSV export.
                                        </p>
                                    </div>
                                </div>
                            }
                            <div class="epi-paddingVertical-small" id="divMainArea">
                                <div id="divContentInstances">
                                    <div class="axiom-grid__cell axiom-grid__cell--span-12-large">

                                        <!-- Top Toolbar -->
                                        <div class="toolbar" id="top-toolbar">
                                            <div class="left-controls flex-gap">
                                                <select id="sitePicker" class="epi-uif-input"><option value="">All Sites</option></select>
                                                <select id="languagePicker" class="epi-uif-input" style="min-width:160px;"></select>
                                                <select id="formPicker" class="epi-uif-input" style="min-width:220px;"></select>
                                                <button id="openFormBtn" class="mdc-button mdc-button--outlined" disabled><i class="fa-solid fa-arrow-up-right-from-square"></i>Open Form</button>
                                            </div>
                                        </div>
                                        <!-- Filters Toolbar -->
                                        <div id="filtersToolbar" class="toolbar hidden">
                                            <div class="left-controls flex-gap">
                                                <input type="search" id="searchBox" class="epi-uif-input" placeholder="Search submissions..." />
                                                <input type="date" id="fromDate" class="epi-uif-input" />
                                                <input type="date" id="toDate" class="epi-uif-input" />
                                                <button id="clearFilterBtn" class="mdc-button">Clear</button>
                                            </div>

                                            <div class="right-controls flex-gap">

                                                <div class="export-dropdown">
                                                    <button id="exportMenuBtn" class="mdc-button mdc-button--unelevated">
                                                        Export as ▾
                                                    </button>
                                                    <div id="exportMenu" class="export-menu hidden">
                                                        <button data-type="csv">CSV</button>
                                                        <button data-type="xml">XML</button>
                                                        <button data-type="json">JSON</button>
                                                    </div>
                                                </div>
                                                <button id="deleteSelectedBtn" class="mdc-button mdc-button--outlined mdc-button--danger" disabled>
                                                    Delete Selected
                                                </button>
                                            </div>
                                        </div>

                                        <div id="resetToolbar" class="toolbar hidden">
                                            <div class="left-controls flex-gap">
                                                <button id="toggleColumnsBtn" class="mdc-button"> <i class="fa-solid fa-table-cells fa-lg"></i>Manage Columns</button>
                                                <button id="refreshTableBtn" class="mdc-button mdc-button--outlined"> <i class="fa-solid fa-arrows-rotate"></i>Refresh Table</button>
                                                <button id="resetSettingsBtn" class="mdc-button mdc-button--outlined"> <i class="fa-solid fa-filter-circle-xmark"></i>Reset Cache</button>
                                            </div>
                                        </div>

                                        <!-- Columns Panel -->
                                        <div id="columnsPanel" class="columns-panel hidden epi-paddingSmall"></div>

                                        <!-- Selection notice -->
                                        <div id="selectionNotice" class="selection-notice hidden"></div>

                                        <!-- Table -->
                                        <div class="table-scroll-container">
                                            <table id="submissionsTable" class="oui-table oui-table--rule oui-table--loose submissions-table" style="width:100%; margin-top:10px;">
                                                <thead>
                                                    <tr id="tableHead"></tr>
                                                </thead>
                                                <tbody id="tableBody"></tbody>
                                            </table>
                                        </div>
                                        <!-- Pagination -->
                                        <div id="paginationBar" class="pagination epi-paddingVertical-small hidden">
                                            <button id="prevPageBtn" class="mdc-button">Previous</button>
                                            <span id="pageInfo" style="margin:0 10px;"></span>
                                            <button id="nextPageBtn" class="mdc-button">Next</button>
                                            <select id="pageSizeSelect" class="epi-uif-input" style="width:70px;">
                                                <option value="25">25</option>
                                                <option value="50" selected>50</option>
                                                <option value="100">100</option>
                                                <option value="250">250</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden Modal -->
                            <div id="quickViewModal" class="modal hidden" aria-hidden="true" role="dialog" aria-label="Submission Quick View">
                                <div class="modal-content">
                                    <button id="closeModalBtn" class="close-btn" aria-label="Close">×</button>
                                    <h2>Submission Quick View</h2>
                                    <div id="modalBody"></div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <div class="loading-text">Loading...</div>
    </div>

    <!-- Scripts -->
    <script src="@scriptJs" asp-append-version="true"></script>
    <required-client-resources area="Footer" />
</body>
</html>

